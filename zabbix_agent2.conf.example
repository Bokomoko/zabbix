# ConfiguraÃ§Ã£o do Zabbix Agent2 para Hosts Externos
# ===========================================
# ğŸ  PROJETO: Zabbix Monitoramento Rede DomÃ©stica
# ğŸ§ OTIMIZADO: Linux Mint / Ubuntu / Debian com PODMAN
# ğŸ“… VERSÃƒO: Zabbix 7.4 LTS
# ===========================================
#
# ğŸ“‹ INSTRUÃ‡Ã•ES RÃPIDAS:
# 1. Copie este arquivo para /etc/zabbix/zabbix_agent2.conf
# 2. Edite as configuraÃ§Ãµes marcadas com âš ï¸
# 3. Reinicie o serviÃ§o: sudo systemctl restart zabbix-agent2
#
# ğŸ”’ IMPORTANTE: Altere TODOS os valores marcados com âš ï¸

# ===========================================
# CONFIGURAÃ‡Ã•ES BÃSICAS
# ===========================================

# Arquivo PID do processo
PidFile=/var/run/zabbix/zabbix_agent2.pid

# Arquivo de log
LogFile=/var/log/zabbix/zabbix_agent2.log

# NÃ­vel de log (0=bÃ¡sico, 1=crÃ­tico, 2=erro, 3=aviso, 4=debug, 5=debug estendido)
LogLevel=3

# Tamanho mÃ¡ximo do arquivo de log (MB)
LogFileSize=100

# ===========================================
# CONFIGURAÃ‡Ã•ES DE REDE
# ===========================================

# âš ï¸ ALTERE: IP ou hostname do Zabbix Server
#
# PARA SERVIDOR LOCAL (mesma rede):
# Server=192.168.1.120
#
# PARA GITHUB CODESPACES (substitua pela sua URL real):
# Server=psychic-funicular-1234567890-10051.app.github.dev
#
# PARA VPS/CLOUD (substitua pelo seu domÃ­nio):
# Server=meu-servidor.exemplo.com
#
# âš ï¸ SUBSTITUA pelo endereÃ§o real do seu servidor Zabbix:
Server=192.168.1.120

# Porta do Zabbix Server (padrÃ£o: 10051)
ServerPort=10051

# âš ï¸ ALTERE: ConfiguraÃ§Ã£o para checks ativos (recomendado para melhor performance)
#
# PARA SERVIDOR LOCAL (mesma rede):
# ServerActive=192.168.1.120:10051
#
# PARA GITHUB CODESPACES (substitua pela sua URL real):
# ServerActive=psychic-funicular-1234567890-10051.app.github.dev:10051
#
# âš ï¸ SUBSTITUA pelo endereÃ§o real do seu servidor Zabbix:
ServerActive=192.168.1.120:10051

# âš ï¸ ALTERE: Nome Ãºnico deste host no Zabbix
# IMPORTANTE: Deve ser Ãºnico para cada dispositivo!
# EXEMPLOS SUGERIDOS:
# - notebook-joao-casa
# - desktop-sala-linux
# - servidor-raspberry-pi
# - workstation-escritorio
Hostname=meu-dispositivo-casa

# ===========================================
# CONFIGURAÃ‡Ã•ES DE INTERFACE LOCAL
# ===========================================

# IP para escutar conexÃµes (0.0.0.0 = todas as interfaces)
ListenIP=0.0.0.0

# Porta para escutar conexÃµes do servidor
ListenPort=10050

# ===========================================
# CONFIGURAÃ‡Ã•ES DE SEGURANÃ‡A
# ===========================================

# âš ï¸ RECOMENDADO: Restringir conexÃµes apenas ao servidor Zabbix
# Descomente e ajuste o IP do seu servidor:
# Server=192.168.1.120,127.0.0.1

# Timeout para conexÃµes (segundos)
Timeout=30

# Permitir execuÃ§Ã£o de comandos remotos (CUIDADO: risco de seguranÃ§a!)
# SÃ³ habilite se necessÃ¡rio e confiar completamente no servidor
EnableRemoteCommands=0

# Permitir parÃ¢metros nÃ£o seguros (scripts personalizados)
# UnsafeUserParameters=1

# ===========================================
# CONFIGURAÃ‡Ã•ES DE PERFORMANCE
# ===========================================

# Intervalo para verificar items ativos (segundos)
RefreshActiveChecks=120

# Buffer para envio de dados
BufferSend=5
BufferSize=100

# NÃºmero mÃ¡ximo de linhas por segundo em logs
MaxLinesPerSecond=20

# ===========================================
# PLUGINS DO ZABBIX AGENT2 (PODMAN/DOCKER)
# ===========================================

# ğŸ§ PODMAN (Linux Mint/Ubuntu - RECOMENDADO)
# Plugin para monitoramento de containers Podman (rootless)
# Descomente a linha abaixo se este host usa Podman:
# Plugins.Docker.Endpoint=unix:///run/user/1000/podman/podman.sock

# ğŸ§ PODMAN (modo root - menos comum)
# Plugins.Docker.Endpoint=unix:///run/podman/podman.sock

# ğŸ³ DOCKER (alternativa)
# Plugin para monitoramento de containers Docker
# Descomente apenas se este host usa Docker em vez de Podman:
# Plugins.Docker.Endpoint=unix:///var/run/docker.sock

# Plugin para monitoramento do systemd
Plugins.Systemd.System=true

# Plugin para monitoramento de processos
Plugins.Proc.System=true

# Plugin para descoberta de interfaces de rede
Plugins.Net.Interface.Discovery=true

# ===========================================
# PARÃ‚METROS PERSONALIZADOS ÃšTEIS
# ===========================================

# ğŸŒ¡ï¸ Temperatura do processador (requer lm-sensors)
# sudo apt install lm-sensors && sudo sensors-detect
UserParameter=cpu.temperature,sensors 2>/dev/null | grep "Core 0" | head -1 | awk '{print $3}' | sed 's/+//;s/Â°C//' || echo "0"

# ğŸ“Š Uso de CPU detalhado
UserParameter=cpu.usage.user,grep "cpu " /proc/stat | awk '{print ($2/($2+$3+$4+$5+$6+$7+$8))*100}'
UserParameter=cpu.usage.system,grep "cpu " /proc/stat | awk '{print ($4/($2+$3+$4+$5+$6+$7+$8))*100}'

# ğŸ’¾ InformaÃ§Ãµes de memÃ³ria em MB
UserParameter=memory.available.mb,free -m | awk 'NR==2{print $7}'
UserParameter=memory.used.percent,free | awk 'NR==2{printf "%.1f", $3*100/$2}'

# ğŸ”¥ Temperatura da GPU NVIDIA (requer nvidia-smi)
UserParameter=gpu.nvidia.temperature,nvidia-smi --query-gpu=temperature.gpu --format=csv,noheader,nounits 2>/dev/null || echo "0"
UserParameter=gpu.nvidia.usage,nvidia-smi --query-gpu=utilization.gpu --format=csv,noheader,nounits 2>/dev/null || echo "0"

# ğŸŒ Velocidade da Internet (requer speedtest-cli)
# sudo apt install speedtest-cli
UserParameter=internet.speed.download,speedtest-cli --simple 2>/dev/null | grep "Download" | awk '{print $2}' || echo "0"
UserParameter=internet.speed.upload,speedtest-cli --simple 2>/dev/null | grep "Upload" | awk '{print $2}' || echo "0"
UserParameter=internet.ping,speedtest-cli --simple 2>/dev/null | grep "Ping" | awk '{print $2}' || echo "0"

# ğŸ”Œ Status de serviÃ§os do sistema
UserParameter=service.status[*],systemctl is-active $1 2>/dev/null && echo "1" || echo "0"
UserParameter=service.enabled[*],systemctl is-enabled $1 2>/dev/null && echo "1" || echo "0"

# ğŸ’¿ InformaÃ§Ãµes de disco
UserParameter=disk.free.percent[*],df -h $1 2>/dev/null | tail -1 | awk '{print $5}' | sed 's/%//' || echo "0"
UserParameter=disk.free.gb[*],df -BG $1 2>/dev/null | tail -1 | awk '{print $4}' | sed 's/G//' || echo "0"
UserParameter=disk.used.gb[*],df -BG $1 2>/dev/null | tail -1 | awk '{print $3}' | sed 's/G//' || echo "0"

# ğŸ–¥ï¸ InformaÃ§Ãµes do sistema
UserParameter=system.uptime.days,awk '{print int($1/86400)}' /proc/uptime
UserParameter=system.uptime.hours,awk '{print int($1/3600)}' /proc/uptime
UserParameter=system.kernel.version,uname -r
UserParameter=system.os.version,lsb_release -d 2>/dev/null | cut -f2 || cat /etc/os-release | grep PRETTY_NAME | cut -d'"' -f2

# ğŸ”‹ Status da bateria (laptops)
UserParameter=battery.level,acpi -b 2>/dev/null | grep -oP '\d+(?=%)' | head -1 || echo "100"
UserParameter=battery.status,acpi -b 2>/dev/null | grep -oP '(Charging|Discharging|Full)' | head -1 || echo "Unknown"
UserParameter=battery.time.remaining,acpi -b 2>/dev/null | grep -oP '\d+:\d+' | head -1 || echo "00:00"

# ğŸŒ¡ï¸ Temperatura de discos (requer hddtemp)
# sudo apt install hddtemp
UserParameter=disk.temperature[*],sudo hddtemp $1 2>/dev/null | awk '{print $4}' | sed 's/Â°C//' || echo "0"

# ğŸ“¡ InformaÃ§Ãµes de rede WiFi
UserParameter=wifi.signal.strength,iwconfig 2>/dev/null | grep "Signal level" | awk '{print $4}' | sed 's/level=//' | head -1 || echo "0"
UserParameter=wifi.essid,iwconfig 2>/dev/null | grep "ESSID" | awk '{print $4}' | sed 's/ESSID://;s/"//g' | head -1 || echo "unknown"

# ğŸ§ InformaÃ§Ãµes especÃ­ficas do Podman (se instalado)
UserParameter=podman.containers.running,podman ps --format "table {{.Names}}" 2>/dev/null | wc -l || echo "0"
UserParameter=podman.containers.total,podman ps -a --format "table {{.Names}}" 2>/dev/null | wc -l || echo "0"
UserParameter=podman.images.count,podman images --format "table {{.Repository}}" 2>/dev/null | wc -l || echo "0"

# ğŸ–¥ï¸ InformaÃ§Ãµes de hardware
UserParameter=hardware.cpu.model,grep "model name" /proc/cpuinfo | head -1 | cut -d':' -f2 | sed 's/^ *//'
UserParameter=hardware.cpu.cores,nproc
UserParameter=hardware.memory.total.gb,free -g | awk 'NR==2{print $2}'

# ===========================================
# CONFIGURAÃ‡Ã•ES PARA DIFERENTES AMBIENTES
# ===========================================

# ğŸ“¡ GITHUB CODESPACES
# Para conectar a um Zabbix em Codespace, descomente e ajuste:
# Server=SEU-CODESPACE-URL-10051.app.github.dev
# ServerActive=SEU-CODESPACE-URL-10051.app.github.dev:10051
# Hostname=codespace-agent-$(hostname)

# ğŸ¥§ RASPBERRY PI
# ParÃ¢metros especÃ­ficos para RPi (descomente se aplicÃ¡vel):
# UserParameter=rpi.cpu.temp,vcgencmd measure_temp 2>/dev/null | awk -F= '{print $2}' | sed 's/Â°C//' || echo "0"
# UserParameter=rpi.gpu.temp,vcgencmd measure_temp 2>/dev/null | awk -F= '{print $2}' | sed 's/Â°C//' || echo "0"
# UserParameter=rpi.cpu.freq,vcgencmd measure_clock arm 2>/dev/null | awk -F= '{print $2/1000000}' || echo "0"

# ğŸŒ ROTEADORES (se suportarem SSH e agente)
# UserParameter=router.wan.ip,curl -s ifconfig.me || echo "unknown"
# UserParameter=router.uptime.days,uptime | awk '{print $3}' | sed 's/,//' || echo "0"

# ===========================================
# INSTRUÃ‡Ã•ES DE INSTALAÃ‡ÃƒO POR SISTEMA
# ===========================================

# ğŸ§ UBUNTU/DEBIAN/LINUX MINT (RECOMENDADO):
# 1. Instalar repositÃ³rio Zabbix:
#    wget https://repo.zabbix.com/zabbix/7.4/ubuntu/pool/main/z/zabbix-release/zabbix-release_latest+ubuntu22.04_all.deb
#    sudo dpkg -i zabbix-release_latest+ubuntu22.04_all.deb
# 2. Atualizar repositÃ³rios e instalar:
#    sudo apt update && sudo apt install -y zabbix-agent2
# 3. Instalar dependÃªncias Ãºteis:
#    sudo apt install -y lm-sensors speedtest-cli acpi hddtemp
# 4. Configurar sensores:
#    sudo sensors-detect
# 5. Copiar configuraÃ§Ã£o:
#    sudo cp zabbix_agent2.conf.example /etc/zabbix/zabbix_agent2.conf
# 6. Editar configuraÃ§Ã£o (IMPORTANTE):
#    sudo nano /etc/zabbix/zabbix_agent2.conf
# 7. Ajustar permissÃµes:
#    sudo chown zabbix:zabbix /etc/zabbix/zabbix_agent2.conf
#    sudo chmod 640 /etc/zabbix/zabbix_agent2.conf
# 8. Reiniciar serviÃ§o:
#    sudo systemctl restart zabbix-agent2
# 9. Habilitar na inicializaÃ§Ã£o:
#    sudo systemctl enable zabbix-agent2
# 10. Verificar status:
#    sudo systemctl status zabbix-agent2

# ğŸ”´ CENTOS/RHEL/ROCKY/ALMA LINUX:
# 1. sudo rpm -Uvh https://repo.zabbix.com/zabbix/7.4/rhel/9/x86_64/zabbix-release-7.4-1.el9.noarch.rpm
# 2. sudo dnf clean all && sudo dnf install -y zabbix-agent2
# 3. sudo dnf install -y lm-sensors speedtest-cli
# 4. sudo cp zabbix_agent2.conf.example /etc/zabbix/zabbix_agent2.conf
# 5. sudo systemctl restart zabbix-agent2 && sudo systemctl enable zabbix-agent2

# ğŸŸ¢ OPENSUSE/SLES:
# 1. sudo zypper ar https://repo.zabbix.com/zabbix/7.4/sles/15/x86_64/ zabbix
# 2. sudo zypper install -y zabbix-agent2
# 3. sudo cp zabbix_agent2.conf.example /etc/zabbix/zabbix_agent2.conf
# 4. sudo systemctl restart zabbix-agent2 && sudo systemctl enable zabbix-agent2

# ğŸ MACOS (via Homebrew):
# 1. brew install zabbix
# 2. cp zabbix_agent2.conf.example /opt/homebrew/etc/zabbix/zabbix_agent2.conf
# 3. brew services start zabbix-agent2

# ğŸªŸ WINDOWS:
# 1. Baixe o MSI do site oficial: https://www.zabbix.com/download_agents
# 2. Instale executando como Administrador
# 3. Copie a configuraÃ§Ã£o para: C:\Program Files\Zabbix Agent 2\zabbix_agent2.conf
# 4. Configure os valores necessÃ¡rios no arquivo
# 5. Execute: sc start "Zabbix Agent 2"

# ===========================================
# VERIFICAÃ‡ÃƒO E TROUBLESHOOTING
# ===========================================

# ğŸ” VERIFICAR SE O AGENTE ESTÃ FUNCIONANDO:
# sudo systemctl status zabbix-agent2
# sudo journalctl -u zabbix-agent2 -f

# ğŸ” TESTAR CONECTIVIDADE COM O SERVIDOR:
# telnet 192.168.1.120 10051
# nc -zv 192.168.1.120 10051

# ğŸ” TESTAR SE O AGENTE RESPONDE LOCALMENTE:
# zabbix_get -s localhost -k agent.ping
# zabbix_get -s localhost -k system.uname

# ğŸ” VER LOGS EM TEMPO REAL:
# sudo tail -f /var/log/zabbix/zabbix_agent2.log

# ğŸ” TESTAR ITENS PERSONALIZADOS:
# zabbix_get -s localhost -k "cpu.temperature"
# zabbix_get -s localhost -k "system.uptime.days"

# ğŸ” VERIFICAR CONFIGURAÃ‡ÃƒO:
# sudo zabbix_agent2 -t agent.ping
# sudo zabbix_agent2 -T

# ğŸ” TESTAR CONECTIVIDADE DE REDE:
# sudo ufw status (verificar firewall)
# ss -tuln | grep 10050 (verificar se porta estÃ¡ escutando)

# ===========================================
# CONFIGURAÃ‡Ã•ES ADICIONAIS DE SEGURANÃ‡A
# ===========================================

# ğŸ”’ FIREWALL (Ubuntu/Debian):
# sudo ufw allow from 192.168.1.120 to any port 10050
# sudo ufw enable

# ğŸ”’ FIREWALL (CentOS/RHEL):
# sudo firewall-cmd --permanent --add-rich-rule='rule family="ipv4" source address="192.168.1.120" port protocol="tcp" port="10050" accept'
# sudo firewall-cmd --reload

# ğŸ”’ SELINUX (se habilitado):
# sudo setsebool -P zabbix_can_network on

# ===========================================
# NOTAS IMPORTANTES
# ===========================================
#
# ğŸ§ PODMAN vs DOCKER: Este arquivo estÃ¡ otimizado para Podman (rootless)
# ğŸ”’ SEGURANÃ‡A: Configure firewall para permitir apenas o IP do servidor
# ğŸ“Š PERFORMANCE: Use checks ativos (ServerActive) para melhor performance
# ğŸ”§ HARDWARE: Instale lm-sensors para monitoramento de temperatura
# ğŸ“± MOBILE: Todos os parÃ¢metros funcionam via app mobile do Zabbix
# ğŸŒ REDE: Configure port forwarding no roteador se necessÃ¡rio
#
# ğŸ“– DocumentaÃ§Ã£o oficial: https://www.zabbix.com/documentation/current/manual/appendix/config/zabbix_agent2
# ğŸ  Projeto: https://github.com/seu-usuario/zabbix-home-monitoring
